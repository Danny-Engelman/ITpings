<!DOCTYPE html>
<html lang="en">
<head>
    <title>ITpings Dashboard</title>

    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge"> <!-- â€  -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.1/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
    <!--
    https://flatuicolors.com/palette/nl
    -->
    <style id="Table definitions">
        body {
            font-family: Helvetica Neue, Arial, sans-serif;
            font-size: 12px;
            margin: 0 auto;
        }

        table {
            table-layout: fixed;
            width: 100%;
            border-spacing: 0px;
        }

        .table-wrapper {
            margin-bottom: 1em;
            border: 1px solid green;
            max-height: 15em;
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* ITpings Table Header */
        thead > tr > td {
            background-color: #42b983;
            color: beige;
            font-weight: bold;
        }

        td {
            text-align: center;
            color: darkolivegreen;
            overflow: hidden;
        }

        th, td {
            min-width: 60px;
        }
    </style>
    <style id="ITpings-table column definitions">

        .applicationTitle {
            font-size: 18px;
        }

        .table-title {
            background: green;
            color: beige;
            font-weight: bolder;
        }

        .ITpings-dashboard > TBODY > TR > TD {
            vertical-align: top;
        }

        [data-column$='pingid'] {
            width: 4em;
        }

        [data-column='time'],
        [data-column='app_id'],
        [data-column='dev_id'] {
            width: 12em;
        }

        /* hide table columns */
        [data-column='description'],
        [data-column='timestamp'],
        [data-column='created'],
        [data-column='payload_raw'],
        [data-column='downlink_url'],
        [data-column$='location_source'],
        [data-column$='src'],
        [data-column$='serial'] {
            display: none;
        }

        [data-column='gtw_id'] {
            width: 8em;
        }

        /* collapse columns on smaller screen width */
        @media (max-width: 1024px) {
            [data-column$='appid'],
            [data-column$='appdevid'],
            [data-column$='gtwid'],
            [data-column$='trusted'] {
                width: .1px;
                background: darkgrey;
            }

            [data-column='app_id'] {
                width: 10em;
                zoom: .8;
            }
        }

        @media (min-width: 1024px) {
            [data-column$='appid'],
            [data-column$='devid'],
            [data-column$='appdevid'],
            [data-column$='sensorid'],
            [data-column='channel'],
            [data-column='rssi'],
            [data-column='snr'],
            [data-column='rf_chain'],
            [data-column$='gtwid'],
            [data-column$='trusted'] {
                width: 3em;
            }

        }

        /* overrule default max-height*/
        itpings-table[query='SensorValues'] .table-wrapper {
            max-height: 50vh;
        }

        /* Hide Columns */
        itpings-table[query='SensorValues'] [data-column$='sensorid'],
        itpings-table[query='SensorValues'] [data-column$='appdevid'],
        itpings-table[query='SensorValues'] [data-column='app_id'],
        itpings-table[query='SensorValues'] [data-column='hardware_serial'] {
            display: none;
        }

        /* Hide TR rows*/
        itpings-table[query='SensorValues'] [data-sensorname^='accelerometer'] {
            display: none;
        }

        .itpings-table-error {
            background: lightcoral;
            color: yellow;
        }

        /* overrule max-height setting and show full table for tables with 'noscroll' attribute */
        itpings-table[noscroll] .table-wrapper {
            max-height: initial;
            overflow-x: initial;
            overflow-y: initial;
        }
    </style>
    <style>
        .overflow-scroll-gradient {
            position: relative;
        }

        .overflow-scroll-gradient::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 300px;
            height: 25px;
            background: linear-gradient(rgba(255, 255, 255, 0.001), white); /* transparent keyword is broken in Safari */
            pointer-events: none;
        }

        .overflow-scroll-gradient__scroller {
            overflow-y: scroll;
            background: white;
            width: 300px;
            height: 250px;
            padding: 15px 0;
            line-height: 1.2;
            text-align: center;
        }

        .truncate-text {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    </style>
    <style id="Color new Pings">
        itpings-table TBODY:nth-child(odd) {
            background-color: beige;
        }

        TBODY.newPing .fadeOutCell {
            animation: fadeOut 60s linear 0s;
        }

        @keyframes fadeOut {
            0% {
                background-color: lightgreen;
                color: black;
            }
            100% {
                background-color: transparent;
                color: darkgrey;
            }
        }

        .unseen_warning {
            background: orange;
        }

    </style>
    <style id="itpings-chart">
        itpings-chart {
            height: 40vh;
            xmax-height: 30vh;
            xposition: relative;
        }

        [data-column='eventvalue'] {
            max-width: 15em;
            overflow: hidden;
        }

        .chart_interval {
            position: absolute;
            top: 2px;
            right: 2px;
        }

        .chart_interval > div {
            border: 1px solid grey;
            width: 2.1em;
            margin-right: 1px;
            text-align: center;
            position: relative;
            float: left;
            font-size: 10px;
        }

        .chart_interval > div:hover {
            cursor: pointer;
            background-color: green;
            color: white;
        }

        .selectedInterval {
            background-color: lightgreen;
        }
    </style>
    <style title="DynamicDeviceColors">
        /* This style definition will be filled by JavaScript */
    </style>
    <!-- run script after CSS declarations, because script references above/existing styles -->
    <script language="JavaScript" src="ITpings_dashboard.js"></script>
</head>
<body>
<a href="https://github.com/Danny-Engelman/ITpings"><img style="position: absolute; top: 0; left: 0; border: 0;"
                                                         src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"
                                                         alt="Fork me on GitHub"></a>
<table class="ITpings-dashboard">
    <thead>
    <tr>
        <th colspan="3">

            <div class="applicationTitle">ITpings Dashboard
                <button id="dropDatabase">Drop Database</button>
                <button id="createDatabase">Create Database</button>
            </div>
            <script>
                let key = 'YOUR_PRIVATE_KEY';// but you better not use this on a public website!

                function doAction(action) {
                    document.location = './ITpings_connector.php?action=' + action + '&key=' + key
                }

                document.querySelector('#dropDatabase').addEventListener('click', _ => {
                    if (confirm('Really??')) doAction('drop');
                });
                document.querySelector('#createDatabase').addEventListener('click', _ => {
                    doAction('create');
                });

            </script>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>
            <itpings-table query="DBInfo" title="ITpings Database Info" noscroll refreshall></itpings-table>
            <itpings-table query="applications" title="All Applications"></itpings-table>
            <itpings-table query="Devices" title="All Devices"></itpings-table>
            <itpings-table query="Events" title="ITpings Events"></itpings-table>
        </td>
        <td>
            <itpings-table query="SensorValues" title="SensorValues"></itpings-table>
        </td>
        <td>
            <itpings-chart chartid="temperature" sensorname="temperature_5" interval="H2"></itpings-chart>
            <itpings-chart chartid="luminosity" sensorname="luminosity_6" interval="H6"></itpings-chart>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <itpings-table query="PingedGateways" title="Pinged Gateways" maxrowcount="10"></itpings-table>
            <itpings-table query="Gateways" title="All Gateways"></itpings-table>
        </td>
        <td>
        </td>
    </tr>

    </tbody>
</table>
</body>
</html>